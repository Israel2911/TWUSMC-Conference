<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üåç 3D World Globe Clock</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000011; overflow: hidden; height: 100vh; }
    #container { position: relative; width: 100vw; height: 100vh; }
    canvas { display: block; width: 100%; height: 100%; }
    .controls { 
      position: absolute; top: 20px; right: 20px; z-index: 100;
    }
    .pause-btn { 
      padding: 15px 25px; background: rgba(0,255,136,0.2); 
      border: 2px solid #00ff88; color: white; border-radius: 30px; 
      cursor: pointer; font-weight: bold; font-size: 16px;
      backdrop-filter: blur(15px); transition: all 0.3s;
    }
    .pause-btn:hover { background: rgba(0,255,136,0.4); transform: scale(1.05); }
    .pause-btn.active { background: #00ff88; color: black; }
  </style>
</head>
<body>
  <div id="container">
    <div class="controls">
      <button class="pause-btn active" id="pauseRotate">‚è∏Ô∏è Pause Rotation</button>
    </div>
  </div>

  <script>
    const container = document.getElementById('container');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x000011);
    container.appendChild(renderer.domElement);

    // CAMERA + CONTROLS
    camera.position.set(0, 0, 2.8);
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.8;

    // LIGHTING
    scene.add(new THREE.AmbientLight(0xffffff, 0.8));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.8);
    dirLight.position.set(2, 2, 2);
    scene.add(dirLight);

    const globeGroup = new THREE.Group();
    scene.add(globeGroup);

    // üó∫Ô∏è EARTH ATLAS TEXTURE
    const textureLoader = new THREE.TextureLoader();
    textureLoader.load(
      'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Land_ocean_ice_2048.jpg/1024px-Land_ocean_ice_2048.jpg',
      (earthTexture) => {
        const globeMaterial = new THREE.MeshLambertMaterial({ 
          map: earthTexture,
          transparent: true,
          opacity: 0.95
        });
        const globe = new THREE.Mesh(new THREE.SphereGeometry(1, 64, 64), globeMaterial);
        globeGroup.add(globe);
      },
      undefined,
      () => {
        // FALLBACK
        globeGroup.add(new THREE.Mesh(
          new THREE.SphereGeometry(1, 64, 64),
          new THREE.MeshLambertMaterial({ color: 0x4169e1, emissive: 0x1e3a8a, emissiveIntensity: 0.3 })
        ));
      }
    );

    // ‚úÖ YOUR EXACT GPS COORDINATES
    const countries = [
      {name: 'üáÆüá≥ India IST', lat: 22, lng: 78, tz: 'Asia/Kolkata', color: 0xFF9933},
      {name: 'üá®üá¶ Canada PST', lat: 56.1304, lng: -106.3468, tz: 'America/Vancouver', color: 0xff0000},
      {name: 'üáπüá≠ Thailand ICT', lat: 13.7563, lng: 100.5018, tz: 'Asia/Bangkok', color: 0xffcc00},
      {name: 'üá™üá∫ Europe CET', lat: 48.8566, lng: 2.3522, tz: 'Europe/Paris', color: 0x0000FF},
      {name: 'üá¨üáß UK GMT', lat: 53, lng: -0.1276, tz: 'Europe/London', color: 0x191970},
      {name: 'üá∫üá∏ USA EST', lat: 39.8283, lng: -98.5795, tz: 'America/New_York', color: 0x003366},
      {name: 'üá∏üá¨ Singapore SGT', lat: 1.35, lng: 103.8, tz: 'Asia/Singapore', color: 0xEE2536},
      {name: 'üá≤üáæ Malaysia MYT', lat: 4, lng: 102, tz: 'Asia/Kuala_Lumpur', color: 0xFFD700}
    ];

    const clockMarkers = [];
    const clockTexts = [];

    // YOUR EXACT GPS FUNCTION
    function latLonToVector3(lat, lon, radius) {
      const phi = (90 - lat) * (Math.PI / 180);
      const theta = (lon + 180) * (Math.PI / 180);
      return new THREE.Vector3(
        -radius * Math.sin(phi) * Math.cos(theta),
        radius * Math.cos(phi),
        radius * Math.sin(phi) * Math.sin(theta)
      );
    }

    // üü° COUNTRY SPHERE MARKERS (PERFECT PLACEMENT)
    countries.forEach((country, index) => {
      // GLOWING SPHERE
      const marker = new THREE.Mesh(
        new THREE.SphereGeometry(0.04, 16, 16),
        new THREE.MeshLambertMaterial({
          color: country.color,
          emissive: country.color,
          emissiveIntensity: index === 0 ? 1.0 : 0.6
        })
      );
      marker.position.copy(latLonToVector3(country.lat, country.lng, 1.18));
      marker.lookAt(0, 0, 0);
      globeGroup.add(marker);
      clockMarkers.push(marker);

      // GLOW RING
      const ring = new THREE.Mesh(
        new THREE.RingGeometry(0.045, 0.06, 16),
        new THREE.MeshBasicMaterial({
          color: country.color,
          side: THREE.DoubleSide,
          transparent: true,
          opacity: 0.6
        })
      );
      ring.lookAt(0, 0, 0);
      globeGroup.add(ring);

      // LIVE CLOCK (ALWAYS VISIBLE)
      const canvas = document.createElement('canvas');
      canvas.width = 256; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      const sprite = new THREE.Sprite(new THREE.SpriteMaterial({
        map: new THREE.CanvasTexture(canvas),
        transparent: true
      }));
      sprite.position.copy(marker.position.clone().add(new THREE.Vector3(0, 0.13, 0)));
      sprite.scale.set(0.18, 0.09, 1);
      globeGroup.add(sprite);

      clockTexts.push({ canvas, ctx, sprite, country, index });
    });

    // ‚úÖ PAUSE BUTTON (FIXED - STOPS ALL ROTATION)
    let isPaused = false;
    document.getElementById('pauseRotate').onclick = () => {
      isPaused = !isPaused;
      controls.autoRotate = !isPaused;
      controls.enableDamping = !isPaused;
      document.getElementById('pauseRotate').classList.toggle('active');
      document.getElementById('pauseRotate').textContent = isPaused ? '‚ñ∂Ô∏è Resume Rotation' : '‚è∏Ô∏è Pause Rotation';
    };

    // RESIZE
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // ANIMATION LOOP
    const clock = new THREE.Clock();
    function animate() {
      requestAnimationFrame(animate);
      
      // ONLY UPDATE CONTROLS (user drag/zoom still works)
      controls.update();

      const elapsed = clock.getElapsedTime();

      // GLOBE ROTATION (STOPS WHEN PAUSED)
      if (!isPaused) {
        globeGroup.rotation.y = elapsed * 0.25;
      }

      // LIVE CLOCKS (ALWAYS UPDATE)
      clockTexts.forEach(ct => {
        const now = new Date();
        const time = now.toLocaleTimeString('en-US', {
          timeZone: ct.country.tz,
          hour12: false,
          hour: '2-digit',
          minute: '2-digit'
        });
        
        ct.ctx.clearRect(0, 0, 256, 128);
        ct.ctx.fillStyle = 'rgba(0,0,0,0.92)';
        ct.ctx.fillRect(0, 0, 256, 128);
        
        ct.ctx.fillStyle = '#ffffff';
        ct.ctx.font = 'bold 24px Arial';
        ct.ctx.textAlign = 'center';
        ct.ctx.textBaseline = 'middle';
        ct.ctx.fillText(ct.country.name.split(' ')[1], 128, 42);
        
        ct.ctx.fillStyle = ct.index === 0 ? '#FFD700' : '#00ff88';
        ct.ctx.font = 'bold 32px Courier New';
        ct.ctx.shadowColor = ct.ctx.fillStyle;
        ct.ctx.shadowBlur = 8;
        ct.ctx.fillText(time, 128, 90);
        ct.ctx.shadowBlur = 0;
        
        ct.sprite.material.map.needsUpdate = true;
      });

      // INDIA PULSE
      clockMarkers[0].scale.setScalar(1 + Math.sin(elapsed * 4) * 0.2);
      clockMarkers[0].rotation.y = elapsed * 2;

      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
