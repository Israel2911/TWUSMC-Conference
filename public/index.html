<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TWU-SMC 11th Annual Leadership Conference</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="/socket.io/socket.io.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<style>
    /* --- CORE STYLES --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%); font-family: 'Nunito', sans-serif; color: #1a365d; overflow-x: hidden; line-height: 1.6; }
    
    .header { display: flex; align-items: center; justify-content: space-between; padding: 15px 40px; background: rgba(255,255,255,0.95); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); box-shadow: 0 2px 20px rgba(0,0,0,0.05); }
    .logo { font-size: 1.5rem; font-weight: 900; color: #167690; }
    .nav { display: flex; gap: 20px; align-items: center; }
    .nav a { text-decoration: none; color: #167690; font-weight: 700; transition: color 0.2s; }
    .nav a:hover { color: #128fa7; }
    .viewer-count { display: none; background: #ff0000; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; align-items: center; gap: 8px; animation: pulse-red 2s infinite; }
    
    /* --- HERO & LIVE --- */
    .hero { position: relative; min-height: 80vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 80px 20px; transition: all 0.5s ease; overflow: hidden; }
    .hero-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; filter: brightness(0.6); transition: filter 0.5s ease; }
    .neural-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; background: radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.2) 0%, transparent 60%); opacity: 0; animation: neural-fire 4s infinite ease-in-out; pointer-events: none; }
    @keyframes neural-fire { 0%, 100% { opacity: 0; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }
    .hero-content-standard { position: relative; z-index: 5; max-width: 1200px; width: 100%; transition: opacity 0.5s ease; }
    .hero-content-live { position: relative; z-index: 10; width: 100%; max-width: 1400px; display: none; margin-top: 20px; }
    .hero h1 { font-size: 4rem; font-weight: 900; color: #167690; margin:0; }
    .hero h2 { font-size: 2rem; color: white; margin: 10px 0 30px 0; }

    /* --- LIVE GRID --- */
    .live-grid { display: grid; grid-template-columns: 2.5fr 1fr; gap: 30px; height: 70vh; min-height: 500px; }
    .video-wrapper { background: black; border-radius: 20px; overflow: hidden; border: 2px solid #333; position: relative; height: 100%; width: 100%; }
    .live-badge { position: absolute; top: 20px; left: 20px; background: #ff0000; color: white; padding: 5px 15px; border-radius: 5px; font-weight: bold; font-size: 0.9rem; z-index: 10; }
    .video-crop { width: 100%; height: 100%; display: block; }
    .video-crop iframe { width: 100%; height: 100%; border: none; display: block; }

    /* --- CHAT SYSTEM --- */
    .human-space-container { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); border-radius: 20px; display: flex; flex-direction: column; height: 100%; border: 1px solid rgba(255,255,255,0.3); overflow: hidden; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    .human-space-header { background: linear-gradient(135deg, #167690, #0f5c70); color: white; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
    .hs-title-row { display: flex; justify-content: space-between; align-items: center; font-weight: 900; font-size: 1.1rem; }
    .teams-link-header { color: white; text-decoration: none; display: flex; align-items: center; gap: 5px; font-size: 0.9rem; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; transition: 0.2s; }
    .teams-link-header:hover { background: rgba(255,255,255,0.3); }
    .download-log { color: rgba(255,255,255,0.8); font-size: 0.8rem; cursor: pointer; text-decoration: underline; }
    
    .tab-row { display: flex; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 3px; }
    .hs-tab { flex: 1; background: transparent; border: none; color: rgba(255,255,255,0.7); padding: 8px; font-weight: bold; cursor: pointer; border-radius: 6px; transition: 0.2s; font-size: 0.9rem; }
    .hs-tab.active { background: white; color: #167690; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    .human-space-messages { flex: 1; padding: 20px; overflow-y: auto; display: none; flex-direction: column; gap: 12px; font-size: 0.95rem; background: #f0f4f8; min-height: 0; }
    .human-space-messages.active { display: flex; }
    
    .login-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
    .coi-note { font-size: 0.75rem; opacity: 0.6; margin-top: 20px; font-style: italic; border-top: 1px solid #eee; padding-top: 10px; max-width: 80%; color: #666; }
    
    .msg { padding: 10px 15px; border-radius: 12px; background: white; align-self: flex-start; max-width: 90%; word-wrap: break-word; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-bottom-left-radius: 2px; position: relative; margin-bottom: 5px; }
    .msg.me { background: #167690; color: white; align-self: flex-end; border-bottom-left-radius: 12px; border-bottom-right-radius: 2px; }
    .msg-meta { font-size: 0.7rem; opacity: 0.6; margin-bottom: 4px; display: block; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    
    .qa-thread { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
    .qa-question { font-weight: bold; color: #2d3748; margin-bottom: 8px; font-size: 1rem; display: block; }
    .qa-replies { margin-top: 10px; padding-left: 15px; border-left: 3px solid #e2e8f0; font-size: 0.9rem; display: flex; flex-direction: column; gap: 8px; }
    .qa-reply-item { background: #f8f9fa; padding: 10px; margin-top: 5px; border-radius: 8px; border-left: 3px solid #ccc; font-size: 0.95rem; }
    
    .human-space-input { padding: 15px; background: white; border-top: 1px solid #eee; }
    .reaction-bar { display: flex; gap: 8px; margin-bottom: 12px; overflow-x: auto; padding-bottom: 5px; }
    .reaction-btn { background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 20px; padding: 6px 12px; font-size: 0.85rem; cursor: pointer; white-space: nowrap; transition: all 0.2s; color: #2d3748; font-weight: 600; }
    .reaction-btn:hover { background: #167690; color: white; transform: translateY(-2px); }
    
    .input-row { display: flex; gap: 10px; }
    .chat-input { flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; outline: none; transition: 0.2s; font-family: inherit; }
    .chat-input:focus { border-color: #167690; }
    .send-btn { background: #167690; color: white; border: none; padding: 0 20px; border-radius: 10px; cursor: pointer; transition: 0.2s; }
    .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; outline: none; }
    .join-btn { background: linear-gradient(135deg, #167690, #0f5c70); color: white; padding: 15px 30px; border-radius: 30px; border: none; font-weight: 800; cursor: pointer; width: 100%; font-size: 1.1rem; margin-top: 10px; box-shadow: 0 5px 15px rgba(22, 118, 144, 0.3); transition: 0.2s; }
    
    .teams-backup { background: linear-gradient(135deg, #1a0000, #000); padding: 40px; text-align: center; color: white; height: 100%; display: flex; flex-direction: column; justify-content: center; border-radius: 20px; }
    
    /* --- GLOBAL SECTION --- */
    .global-connect-section { position: relative; z-index: 5; background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #000000 100%); padding: 80px 40px; display: flex; flex-wrap: wrap; justify-content: center; gap: 60px; max-width: 1400px; margin: 0 auto; }
    
    .globe-wrapper { 
        width: 500px; height: 500px; position: relative; 
        border-radius: 50%; background: radial-gradient(circle at 40% 40%, #1e2636 0%, #000000 90%); 
        border: 4px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
        overflow: hidden; 
        z-index: 10; transform: translateZ(0); 
    }
    #heroGlobeContainer { width: 100%; height: 100%; border-radius: 50%; overflow: hidden; }
    .pause-btn { background: #167690; color: white; padding: 8px 20px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 0.9rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.2s; }
    
    .times-wrapper { flex: 1; min-width: 350px; max-width: 600px; }
    .globe-times-stack { display: flex; flex-direction: column; gap: 12px; }
    .globe-time-item { background: white; padding: 15px 25px; border-radius: 16px; border: 1px solid #edf2f7; border-left: 6px solid #ddd; display: grid; grid-template-columns: 1.5fr 1.5fr 1fr; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.03); transition: transform 0.2s; }
    .globe-time-item:hover { transform: translateX(5px); }
    .card-identity { display: flex; align-items: center; gap: 15px; }
    .globe-flag { font-size: 1.8rem; }
    .globe-name { font-weight: 800; color: #2d3748; font-size: 1.1rem; }
    .card-stats { display: flex; align-items: center; gap: 15px; color: #718096; font-size: 0.85rem; font-weight: 600; }
    .stat-pill { display: flex; align-items: center; gap: 6px; background: #f7fafc; padding: 4px 10px; border-radius: 20px; }
    .globe-time { font-family: 'Courier New', monospace; font-weight: 900; font-size: 1.4rem; color: #ff6b35; text-align: right; }
    
    /* --- SYNOPSIS --- */
    .section { padding: 80px 40px; max-width: 1200px; margin: 0 auto; text-align: center; }
    .section-header { font-size: 2.5rem; color: #167690; margin-bottom: 40px; font-weight:900; }
    .synopsis-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 60px; align-items: center; max-width: 1200px; margin: 0 auto; }
    .synopsis-card { background: white; padding: 40px; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.05); text-align: left; position: relative; overflow: hidden; transition: all 0.3s ease; }
    .synopsis-expanded { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; }
    .synopsis-expanded.open { max-height: 3000px; }
    .synopsis-expanded h3 { font-size: 1.35rem; color: #265057; margin-top: 25px; margin-bottom: 15px; }
    .synopsis-expanded blockquote { margin: 25px 0; padding: 20px; background: #f7f9ff; border-left: 6px solid #128fa7; font-size: 1.15rem; color: #265057; font-style: italic; }
    
    .expand-btn { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 25px; padding: 12px 30px; background: #167690; color: white; border: none; border-radius: 25px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; width: 100%; }
    .expand-btn:hover { background: #128fa7; transform: translateY(-2px); }
    .expand-btn .material-icons-round { transition: transform 0.3s ease; }
    .expand-btn.open .material-icons-round { transform: rotate(180deg); }
    
    .agenda-table { width: 100%; border-collapse: collapse; text-align: left; }
    .agenda-table tr { transition: background 0.2s; }
    .agenda-table tr:hover { background: #f7fafc; }
    
    .content-box { background: white; padding: 60px; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.05); text-align: left; font-size: 1.1rem; }
    .pdf-preview { position: relative; width: 100%; height: 0; padding-bottom: 75%; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #ddd; background: #525659; margin-bottom: 20px; }
    .pdf-btn { display: inline-block; background: #167690; color: white; padding: 15px 30px; border-radius: 30px; text-decoration: none; font-weight: bold; margin-top: 20px; transition: 0.2s; }

    /* --- ADMIN PANEL: ALWAYS VISIBLE --- */
    .admin-panel { display: flex; position: fixed; bottom: 20px; right: 20px; z-index: 9999; gap: 10px; flex-direction: column; }
    .admin-btn { padding: 10px 20px; border-radius: 30px; cursor: pointer; font-weight: bold; border: 2px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: all 0.3s; }
    .btn-live { background: #333; color: white; } 
    /* KILL SWITCH: HIDDEN BY DEFAULT (Shown only via JS if Admin & Live) */
    .btn-kill { background: #ff0000; color: white; display: none; }

    /* REPLY OVERLAY: INSIDE THE CONTAINER */
    #replyOverlay { 
        display:none; 
        position:absolute; 
        bottom:0; 
        left:0; 
        width:100%; 
        background:#f8f9fa; 
        border-top:1px solid #ddd; 
        padding:15px; 
        z-index: 50; 
        box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
    }
    
    @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

    #bookContainer { width: 100%; height: 500px; min-height: 400px; position: relative; background: radial-gradient(circle at 50% 50%, #2c3e50 0%, #000000 100%); border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }

    /* --- MOBILE RESPONSIVE --- */
    @media screen and (max-width: 768px) {
        html, body { overflow-x: hidden; width: 100%; position: relative; }
        .header { flex-direction: column; padding: 15px; gap: 15px; }
        .nav { flex-wrap: wrap; justify-content: center; gap: 15px; }
        .logo { font-size: 1.3rem; text-align: center; }
        .viewer-count { display: flex !important; margin-bottom: 10px; }
        .hero h1 { font-size: 2.2rem; line-height: 1.2; padding: 0 10px; }
        .hero h2 { font-size: 1.2rem; margin-bottom: 20px; }
        .hero { min-height: 60vh; padding: 40px 15px; }
        .synopsis-grid { display: flex !important; flex-direction: column-reverse !important; gap: 20px !important; }
        .synopsis-card { width: 100% !important; padding: 20px !important; margin: 0 !important; }
        #bookContainer { width: 100% !important; height: 350px !important; max-width: 350px !important; margin: 0 auto !important; display: block !important; position: relative; }
        .live-grid { display: flex !important; flex-direction: column; height: auto !important; gap: 15px; }
        .video-wrapper { width: 100% !important; height: auto !important; aspect-ratio: 16 / 9; min-height: 220px; }
        .human-space-container { width: 100% !important; height: 600px !important; border-left: none; border-top: 1px solid #ddd; }
        .global-connect-section { flex-direction: column; padding: 40px 15px; gap: 20px; }
        .globe-wrapper { width: 280px !important; height: 280px !important; margin: 0 auto 20px auto; border-radius: 50% !important; overflow: hidden !important; }
        .times-wrapper { width: 100% !important; max-width: 100% !important; }
        .globe-times-stack { display: flex !important; flex-direction: row !important; overflow-x: auto; gap: 15px; padding-bottom: 20px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
        .globe-time-item { flex: 0 0 85%; scroll-snap-align: center; flex-direction: column; align-items: center; text-align: center; padding: 20px; gap: 10px; border-right: 1px solid #eee; margin-right: 0; }
        .card-identity { flex-direction: column; gap: 5px; }
        .globe-time { font-size: 1.4rem; text-align: center; width: 100%; margin-top: 5px; }
        .card-stats { display: flex; align-items: center; justify-content: center; gap: 15px; width: 100%; }
        #pauseBtn { position: relative !important; bottom: auto !important; left: auto !important; transform: none !important; margin: 20px auto 0 auto; display: block; width: 200px; }
    }
</style>
</head>
<body>

<div class="admin-panel" id="adminPanel">
  <button class="admin-btn btn-live" id="liveToggle">üî¥ GO LIVE</button>
  <button class="admin-btn btn-kill" id="killSwitch">‚ö†Ô∏è END STREAM</button>
</div>

<header class="header">
  <div class="logo">TWU-SMC 11th Annual Leadership Conference</div>
  <nav class="nav">
    <div class="viewer-count" id="viewerCount">
      <span class="material-icons-round">visibility</span>
      <span id="countNum">0</span> Watching
    </div>
    <a href="#">Home</a>
    <a href="#synopsis">About</a>
    <a href="#agenda">Agenda</a>
    <a href="#resources">Resources</a>
  </nav>
</header>

<section class="hero">
  <img src="humanintelligence.png" alt="Background" class="hero-bg" id="heroBg">
  <div class="neural-overlay"></div>
  <div class="hero-content-standard" id="heroStandard">
    <h1>The Fifth Intelligence</h1>
    <h2>Integrating the Human Factor</h2>
  </div>
  
  <div class="hero-content-live" id="heroLive" style="display:none;">
    <div class="live-grid">
      <div class="video-wrapper" id="vidWrap">
        <div class="live-badge">üî¥ LIVE</div>
        <div class="video-crop">
          <iframe id="feed" src="https://www.youtube.com/embed/97vsV_lwXPo?autoplay=0&controls=1&mute=0&playsinline=1&modestbranding=1&rel=0" width="100%" height="100%" title="Live Stream" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>
      <div class="human-space-container">
        <div class="human-space-header">
          <div class="hs-title-row">
            <div style="display:flex; align-items:center; gap:10px;"><span class="material-icons-round">forum</span> The Human Space</div>
            <div style="display:flex; gap:10px;">
              <a href="https://teams.microsoft.com/meet/25727590322372?p=Toyeb2xMWy8NeEJiA2" target="_blank" class="teams-link-header"><span class="material-icons-round" style="font-size:16px;">videocam</span> Teams</a>
              <span id="downloadLogBtn" class="download-log">‚¨á LOG</span>
            </div>
          </div>
          <div class="tab-row">
            <button class="hs-tab active" onclick="switchTab('chat')">üí¨ Chat Lounge</button>
            <button class="hs-tab" onclick="switchTab('qa')">‚ùì Q&A Forum</button>
          </div>
        </div>
        
        <div class="login-overlay" id="chatLogin">
          <h3 style="font-size:1.5rem; color:#167690; margin-bottom:10px;">Enter the Human Space</h3>
          <p style="font-size:1rem; margin-bottom:30px; color:#666;">Secure, Proprietary, Connected.</p>
          <input type="text" id="chatName" class="login-input" placeholder="Your Name" maxlength="20">
          <select id="chatCountry" class="login-input">
            <option value="" disabled selected>Select Your Region</option>
            <option value="India">üáÆüá≥ India</option>
            <option value="Canada">üá®üá¶ Canada</option>
            <option value="Thailand">üáπüá≠ Thailand</option>
            <option value="USA">üá∫üá∏ USA</option>
            <option value="Other">üåç Global</option>
          </select>
          <button class="join-btn" onclick="joinChat()">Join Conversation</button>
          <div class="coi-note">Inspired by the <strong>Community of Inquiry (CoI)</strong> framework.</div>
        </div>

        <div class="human-space-messages active" id="chatTab">
             <div style="text-align:center; opacity:0.6; margin-top:40px; padding:20px;">
                <span class="material-icons-round" style="font-size:3rem; color:#cbd5e0;">public</span>
                <br><br><strong>Global Lounge</strong><br>Say hello, share reactions, and connect.
            </div>
        </div>
        <div class="human-space-messages" id="qaTab">
            <div style="text-align:center; opacity:0.6; margin-top:40px; padding:20px;">
                <span class="material-icons-round" style="font-size:3rem; color:#cbd5e0;">psychology_alt</span>
                <br><br><strong>Q&A Forum</strong><br>Post deep questions here. Faculty will respond.
            </div>
        </div>
        
        <div class="human-space-input">
          <div class="reaction-bar" id="reactionBar"></div>
          <div class="input-row">
            <input type="text" id="msgInput" class="chat-input" placeholder="Share your thoughts..." onkeypress="handleEnter(event)">
            <button class="send-btn" onclick="sendMessage()"><span class="material-icons-round">send</span></button>
          </div>
        </div>

        <div id="replyOverlay">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <strong style="color:#167690;">Reply to Thread</strong>
                <span onclick="closeReply()" style="cursor:pointer; color:#666; font-weight:bold;">‚úï</span>
            </div>
            <input type="text" id="replyInput" placeholder="Type answer..." style="width:100%; padding:12px; border-radius:8px; border:1px solid #ccc; margin-bottom:10px;">
            <button onclick="submitReply()" style="width:100%; background:#167690; color:white; border:none; padding:10px; border-radius:8px; font-weight:bold;">Post Reply</button>
        </div>

      </div>
    </div>
  </div>
</section>

<section class="global-connect-section">
  <div class="globe-wrapper">
    <div id="heroGlobeContainer"></div> 
  </div>
  <button class="pause-btn" id="pauseBtn" style="display:none;">‚è∏ Pause</button>

  <div class="times-wrapper">
    <h3 style="font-size: 2rem; color:#ffffff; margin-bottom:30px; font-weight:900;">üåç Global Community</h3>
    <div class="globe-times-stack" id="timeStack"></div>
  </div>
</section>

<section class="section" id="synopsis">
  <h2 class="section-header">Conference Overview</h2>
  <div class="synopsis-grid">
    <div class="synopsis-card">
      <div class="synopsis-preview">
        <p style="margin-bottom: 20px;">
          Join us as <strong>Dr. Laird</strong>, Vice President of Innovation at TWU, unveils concepts from his new book on <strong>"Fifth Intelligence."</strong>
        </p>
        <p style="font-size: 1.05rem; color: #265057;">Transformative insights from global thought leaders.</p>
      </div>
      <div class="synopsis-expanded" id="synopsisExpanded">
        <h3 style="font-size: 1.5rem; color: #167690; margin-top: 30px; margin-bottom: 15px;">Integrating the Human Factor</h3>
        <p style="margin-bottom: 30px;">This conference explores how higher-order human thinking can steer AI development.</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
          <div style="background: #f7fafc; padding: 20px; border-radius: 15px; border-left: 5px solid #167690;">
            <h4 style="color: #2d3748; margin-bottom: 5px; font-size: 1rem;">Emotional Intelligence</h4>
            <p style="font-size: 0.9rem; color: #4a5568;">Empathy & Perspective-Taking</p>
          </div>
          <div style="background: #f7fafc; padding: 20px; border-radius: 15px; border-left: 5px solid #48bb78;">
            <h4 style="color: #2d3748; margin-bottom: 5px; font-size: 1rem;">Truth & Transparency</h4>
            <p style="font-size: 0.9rem; color: #4a5568;">Accountability in Systems</p>
          </div>
          <div style="background: #f7fafc; padding: 20px; border-radius: 15px; border-left: 5px solid #ed8936;">
            <h4 style="color: #2d3748; margin-bottom: 5px; font-size: 1rem;">Critical Consciousness</h4>
            <p style="font-size: 0.9rem; color: #4a5568;">Higher-Order Thinking</p>
          </div>
        </div>
        <blockquote><strong>Key Message:</strong> AI amplifies capabilities, but human sensitivity and ethical grounding must lead the way.</blockquote>
      </div>
      <button class="expand-btn" id="expandBtn"><span>Read More</span><span class="material-icons-round">expand_more</span></button>
    </div>
    <div style="width: 100%; display: flex; justify-content: center; align-items: center;">
      <div id="bookContainer"></div>
    </div>
  </div>
</section>

<section class="section" id="agenda">
  <h2 class="section-header">Agenda</h2>
  <div class="content-box" style="padding:0; overflow:hidden;">
    <table class="agenda-table" style="width:100%; border-collapse:collapse;">
      <tr style="background:#167690; color:white;"><th style="padding:15px;">Time (IST)</th><th style="padding:15px;">Session</th></tr>
      <tr><td style="padding:15px; border-bottom:1px solid #eee;">10:00 AM</td><td style="padding:15px; border-bottom:1px solid #eee;">Welcome & Opening</td></tr>
      <tr><td style="padding:15px; border-bottom:1px solid #eee;">10:30 AM</td><td style="padding:15px; border-bottom:1px solid #eee;">Keynote: Fifth Intelligence</td></tr>
      <tr><td style="padding:15px; border-bottom:1px solid #eee;">11:15 AM</td><td style="padding:15px; border-bottom:1px solid #eee;">Workshop: Human-AI Integration</td></tr>
      <tr><td style="padding:15px; border-bottom:1px solid #eee;">03:30 PM</td><td style="padding:15px; border-bottom:1px solid #eee;">Closing</td></tr>
    </table>
  </div>
</section>

<section class="section" id="resources">
  <h2 class="section-header">Resources</h2>
  <div class="content-box" style="text-align:center; padding: 40px 20px;">
    <h3>Conference Brochure</h3>
    <p style="margin-bottom:20px; opacity:0.8;">View, scroll, and download the full schedule below.</p>
    <div class="pdf-preview">
      <iframe src="GLOB%20SMC%20Leadership%20Conference%202025_Brochure_Final5.pdf#toolbar=1&view=FitH" width="100%" height="100%" style="border:none; position:absolute; top:0; left:0;"></iframe>
    </div>
    <a href="GLOB%20SMC%20Leadership%20Conference%202025_Brochure_Final5.pdf" download class="pdf-btn"><span class="material-icons-round" style="vertical-align:middle; margin-right:5px;">download</span> Download PDF</a>
  </div>
</section>

<script>
const express = require('express');
const http = require('http');
const { Server } = require('socket.io');
const path = require('path');
const helmet = require('helmet');
const cors = require('cors');
const rateLimit = require('express-rate-limit');

const app = express();
const server = http.createServer(app);

app.use(
  helmet({
    contentSecurityPolicy: false,
    crossOriginEmbedderPolicy: false,
    referrerPolicy: { policy: "strict-origin-when-cross-origin" }
  })
);
app.use(cors({ origin: "*", methods: ["GET", "POST"] }));

const limiter = rateLimit({ windowMs: 15 * 60 * 1000, max: 100 });
app.use(limiter);

app.use(express.static(path.join(__dirname, 'public'), { acceptRanges: false }));

const io = new Server(server, { cors: { origin: "*", methods: ["GET", "POST"] } });

// GLOBAL STATE
let K = false;
let T = 0;
let R = {};
let A = {};
let userLiveStates = {};
const ADMIN_PASS = "TWU2025";

const MAX_HISTORY = 60;
let chatHistory = [];
let qaHistory = [];

const lastMsgTime = {};
const RATE_LIMIT_MS = 800;
const MAX_MSG_LENGTH = 500;

// AI facilitator
const AI_NAME = "ü§ñ Session Facilitator";
const AI_QUESTIONS = [
  "How do you see AI influencing moral decision-making in your field?",
  "What role does empathy play in the future of digital leadership?",
  "How can education systems adapt to the rapid pace of technological change?",
  "What is the biggest challenge for cross-cultural collaboration today?",
  "How do we maintain human connection in an increasingly virtual world?",
  "What defines 'scholarly excellence' in the age of artificial intelligence?",
  "Can leadership truly be taught, or is it an inherent trait enhanced by technology?"
];
let aiIndex = 0;

function emptyReactions() {
  return { 'üéì': [], 'üí°': [], 'ü§ù': [], '‚≠ê': [], 'üìú': [], 'üß†': [] };
}

setInterval(() => {
  if (K) return;
  const qText = AI_QUESTIONS[aiIndex];
  aiIndex = (aiIndex + 1) % AI_QUESTIONS.length;
  const threadData = {
    id: 'qa-' + Date.now(),
    user: AI_NAME,
    text: qText,
    country: 'System',
    isAi: true,
    replies: [],
    reactions: emptyReactions(),
    flags: []
  };
  qaHistory.push(threadData);
  io.emit('qaIncoming', threadData);
}, 60000); // 1 minute

function escapeHtml(text) {
  if (!text) return "";
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

io.on('connection', (socket) => {
  T++;
  userLiveStates[socket.id] = false;

  socket.emit('history', { chat: chatHistory, qa: qaHistory });
  socket.emit('z', { isLive: userLiveStates[socket.id], isKilled: K });

  io.emit('t', T);
  io.emit('r', R);

  socket.on('r', (tz) => {
    A[socket.id] = tz;
    if (!R[tz]) R[tz] = 0;
    R[tz]++;
    io.emit('r', R);
  });

  // per-viewer GO LIVE
  socket.on('x', () => {
    userLiveStates[socket.id] = !userLiveStates[socket.id];
    socket.emit('z', { isLive: userLiveStates[socket.id], isKilled: K });
  });

  // CHAT
  socket.on('chatMsg', (payload) => {
    const now = Date.now();
    if (lastMsgTime[socket.id] && now - lastMsgTime[socket.id] < RATE_LIMIT_MS) return;
    lastMsgTime[socket.id] = now;

    if (!payload.text || payload.text.length > MAX_MSG_LENGTH) return;

    const msgData = {
      id: 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
      user: escapeHtml(payload.user),
      text: escapeHtml(payload.text),
      country: escapeHtml(payload.country || ''),
      type: 'chat',
      flags: [],
      reactions: {}
    };
    chatHistory.push(msgData);
    if (chatHistory.length > MAX_HISTORY) chatHistory.shift();
    io.emit('chatIncoming', msgData);
  });

  socket.on('chatReact', ({ id, emoji, user }) => {
    const msg = chatHistory.find(m => m.id === id);
    if (!msg) return;
    if (!msg.reactions) msg.reactions = {};
    if (!msg.reactions[emoji]) msg.reactions[emoji] = [];
    const list = msg.reactions[emoji];
    const idx = list.indexOf(user);
    if (idx === -1) list.push(user); else list.splice(idx, 1);
    io.emit('chatReactionUpdate', { id, reactions: msg.reactions });
  });

  socket.on('chatFlag', ({ id, user }) => {
    const msg = chatHistory.find(m => m.id === id);
    if (!msg) return;

    if (!msg.flags) msg.flags = [];
    if (!msg.flags.includes(user)) msg.flags.push(user);

    const shouldDelete = msg.flags.length >= 3 || msg.user === user;
    if (shouldDelete) {
      chatHistory = chatHistory.filter(m => m.id !== id);
      io.emit('chatDeleted', id);

      const notice = {
        id: 'sys-' + Date.now(),
        user: 'üõ° Community Notice',
        text: "A message was removed after being red-flagged by our community. Disagreement is welcome, but posts must remain respectful. Please flag harmful or inappropriate content so we can keep this space safe.",
        country: 'System',
        type: 'chat',
        flags: [],
        reactions: {}
      };
      chatHistory.push(notice);
      if (chatHistory.length > MAX_HISTORY) chatHistory.shift();
      io.emit('chatIncoming', notice);
    } else {
      io.emit('chatFlagUpdate', { id, flags: msg.flags });
    }
  });

  // QA threads
  socket.on('qaAsk', (payload) => {
    if (!payload.text || payload.text.length > MAX_MSG_LENGTH) return;
    const threadData = {
      id: 'qa-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
      user: escapeHtml(payload.user),
      text: escapeHtml(payload.text),
      country: escapeHtml(payload.country || ''),
      replies: [],
      reactions: emptyReactions(),
      flags: []
    };
    qaHistory.push(threadData);
    io.emit('qaIncoming', threadData);
  });

  socket.on('qaFlag', ({ id, user }) => {
    const thread = qaHistory.find(t => t.id === id);
    if (!thread) return;

    if (!thread.flags) thread.flags = [];
    if (!thread.flags.includes(user)) thread.flags.push(user);

    const shouldDelete = thread.flags.length >= 3 || thread.user === user;
    if (shouldDelete) {
      qaHistory = qaHistory.filter(t => t.id !== id);
      io.emit('qaDeleted', id);
    } else {
      io.emit('qaFlagUpdate', { id, flags: thread.flags });
    }
  });

  socket.on('qaReply', (payload) => {
    if (!payload.text || payload.text.length > MAX_MSG_LENGTH) return;
    const replyData = {
      id: 'rep-' + Date.now(),
      user: escapeHtml(payload.user),
      text: escapeHtml(payload.text),
      reactions: emptyReactions(),
      flags: []
    };
    const thread = qaHistory.find(t => t.id === payload.threadId);
    if (thread) {
      if (!thread.replies) thread.replies = [];
      thread.replies.push(replyData);
    }
    io.emit('qaReplyIncoming', { threadId: payload.threadId, ...replyData });
  });

  socket.on('qaReact', ({ threadId, emoji, user }) => {
    const allowed = ['üéì', 'üí°', 'ü§ù', '‚≠ê', 'üìú', 'üß†'];
    if (!allowed.includes(emoji)) return;
    const thread = qaHistory.find(t => t.id === threadId);
    if (!thread) return;
    if (!thread.reactions) thread.reactions = emptyReactions();
    if (!Array.isArray(thread.reactions[emoji])) thread.reactions[emoji] = [];
    const list = thread.reactions[emoji];
    const idx = list.indexOf(user);
    if (idx === -1) list.push(user); else list.splice(idx, 1);
    io.emit('qaReactionUpdate', { threadId, reactions: thread.reactions });
  });

  socket.on('qaReplyReact', ({ threadId, replyId, emoji, user }) => {
    const allowed = ['üéì', 'üí°', 'ü§ù', '‚≠ê', 'üìú', 'üß†'];
    if (!allowed.includes(emoji)) return;
    const thread = qaHistory.find(t => t.id === threadId);
    if (!thread || !thread.replies) return;
    const reply = thread.replies.find(r => r.id === replyId);
    if (!reply) return;
    if (!reply.reactions) reply.reactions = emptyReactions();
    if (!reply.reactions[emoji]) reply.reactions[emoji] = [];
    const list = reply.reactions[emoji];
    const idx = list.indexOf(user);
    if (idx === -1) list.push(user); else list.splice(idx, 1);
    io.emit('qaReplyReactionUpdate', { threadId, replyId, reactions: reply.reactions });
  });

  socket.on('qaReplyFlag', ({ threadId, replyId, user }) => {
    const thread = qaHistory.find(t => t.id === threadId);
    if (!thread || !thread.replies) return;
    const reply = thread.replies.find(r => r.id === replyId);
    if (!reply) return;

    if (!reply.flags) reply.flags = [];
    if (!reply.flags.includes(user)) reply.flags.push(user);

    const shouldDelete = reply.flags.length >= 3 || reply.user === user;
    if (shouldDelete) {
      thread.replies = thread.replies.filter(r => r.id !== replyId);
      io.emit('qaReplyDeleted', { threadId, replyId });
    } else {
      io.emit('qaReplyFlagUpdate', { threadId, replyId, flags: reply.flags });
    }
  });

  // Admin kill
  socket.on('k', (password) => {
    if (password !== ADMIN_PASS) return;
    K = true;
    for (let id in userLiveStates) userLiveStates[id] = false;
    io.emit('z', { isLive: false, isKilled: true });
    io.emit('d');
  });

  socket.on('disconnect', () => {
    T--;
    const tz = A[socket.id];
    if (tz && R[tz] > 0) R[tz]--;
    delete A[socket.id];
    delete userLiveStates[socket.id];
    io.emit('t', T);
    io.emit('r', R);
  });
});

const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
  console.log(`üöÄ Secure Server running on port ${PORT}`);
});

</script>


</body>
</html>
